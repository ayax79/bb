<?xml version="1.0" encoding="UTF-8"?>
<!--
server layer config
-->
<tc:tc-config xmlns:tc="http://www.terracotta.org/config"
              xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
              xsi:schemaLocation="http://www.terracotta.org/schema/terracotta-4.xsd">
    <servers>
        <server name="localhost" host="localhost">
            <dso-port>9510</dso-port>
            <jmx-port>9520</jmx-port>
            <data>target/terracotta/server/data</data>
            <logs>target/terracotta/server/logs</logs>
            <statistics>target/terracotta/server/statistics</statistics>
            <dso>
                <persistence>
                    <mode>permanent-store</mode>
                </persistence>
            </dso>
        </server>
        <update-check>
            <enabled>true</enabled>
        </update-check>
    </servers>

    <!-- ********************************************* -->
    <!-- * Any app-level config changes made must be * -->
    <!-- * be mirrored in tc-config-prod.xml as well * -->
    <!-- ********************************************* -->

    <clients>
        <logs>target/terracotta/clients/logs/%(tc.nodeName)</logs>
        <statistics>target/terracotta/clients/statistics/%(tc.nodeName)</statistics>

        <modules>
            <!-- This modules list is different between server-terracotta-config.xml and tc-config-prod.xml -->
            <!-- The prod version uses tomcat amd the dev version jetty -->
            <module name="tim-jetty-6.1" version="2.0.0-SNAPSHOT"/>
            <module name="tim-annotations" version="1.4.0-SNAPSHOT"/>
            <module name="tim-hibernate-3.3" version="1.4.0-SNAPSHOT"/>
            <module name="tim-concurrent-collections" version="1.2.0-SNAPSHOT"/>
            <module name="tim-map-evictor" version="1.2.0-SNAPSHOT"/>
            <module name="tim.pipes.version" version="2.1.1-SNAPSHOT"/>
            <module name="tim-hibernate-cache-3.3" version="1.0.0-SNAPSHOT"/>
            <!--<module name="tim-async-processing" version="1.2.0-SNAPSHOT"/>-->
        </modules>
    </clients>
    <application>
        <dso>
            <additional-boot-jar-classes>
                <include>java.net.InetAddress</include>
                <include>java.net.Inet6Address</include>
                <include>java.io.OutputStream</include>
            </additional-boot-jar-classes>
            <instrumented-classes>
                <!--
                Begin compass
                -->
                <include>
                    <class-expression>org.compass.needle.terracotta.*</class-expression>
                    <honor-transient>true</honor-transient>
                </include>
                <include>
                    <class-expression>org.compass.needle.terracotta.transaction.processor.*</class-expression>
                    <honor-transient>true</honor-transient>
                </include>
                <include>
                    <class-expression>org.compass.core.lucene.engine.transaction.support.*</class-expression>
                    <honor-transient>true</honor-transient>
                </include>
                <include>
                    <class-expression>org.apache.lucene.store.Directory</class-expression>
                    <honor-transient>true</honor-transient>
                </include>
                <include>
                    <class-expression>org.apache.lucene.store.LockFactory</class-expression>
                    <honor-transient>true</honor-transient>
                </include>
                <include>
                    <class-expression>org.compass.core.lucene.engine.transaction.support.job.*</class-expression>
                    <honor-transient>true</honor-transient>
                </include>
                <include>
                    <class-expression>org.compass.core.spi.ResourceKey</class-expression>
                    <honor-transient>true</honor-transient>
                </include>
                <include>
                    <class-expression>org.compass.core.lucene.LuceneResource</class-expression>
                    <honor-transient>true</honor-transient>
                </include>
                <include>
                    <class-expression>org.compass.core.lucene.LuceneProperty</class-expression>
                    <honor-transient>true</honor-transient>
                </include>
                <include>
                    <class-expression>org.apache.lucene.document.Field</class-expression>
                    <honor-transient>true</honor-transient>
                </include>
                <include>
                    <class-expression>org.apache.lucene.document.AbstractField</class-expression>
                    <honor-transient>true</honor-transient>
                </include>
                <include>
                    <class-expression>org.apache.lucene.search.*</class-expression>
                    <honor-transient>true</honor-transient>
                </include>
                <!--
                End compass
                -->
            </instrumented-classes>
            <locks>
                <autolock>
                    <method-expression>* org.compass.needle.terracotta.*.*(..)</method-expression>
                    <lock-level>write</lock-level>
                </autolock>
                <autolock>
                    <method-expression>* org.compass.needle.terracotta.*.get*(..)</method-expression>
                    <lock-level>read</lock-level>
                </autolock>
            </locks>
            <roots>
                <root>
                    <field-name>org.compass.needle.terracotta.TerracottaDirectoryStore.dirs</field-name>
                </root>
                <root>
                    <field-name>org.compass.needle.terracotta.TerracottaDirectoryStore.managedRWL</field-name>
                </root>
                <root>
                    <field-name>org.compass.needle.terracotta.TerracottaLockFactoryProvider.lockFactories</field-name>
                </root>
                <root>
                    <field-name>org.compass.needle.terracotta.TerracottaManagerUtilLockFactoryProvider.lockFactories
                    </field-name>
                </root>
                <root>
                    <field-name>
                        org.compass.needle.terracotta.transaction.processor.TerracottaTransactionProcessorFactory.holder
                    </field-name>
                </root>
                <root>
                    <field-name>org.compass.core.lucene.engine.transaction.support.orderLocks</field-name>
                </root>
            </roots>
        </dso>
        <spring>
            <jee-application name="server">
                <application-contexts>
                    <application-context>
                        <paths>
                            <path>spring/*.xml</path>
                            <path>camel/*.xml</path>
                        </paths>
                        <beans>
                            <bean name="userActivityStreamCache"/>
                            <bean name="shoppingCartCache"/>
                            <bean name="userVerifificationCache"/>
                            <bean name="txManager"/>
                            <!--<bean name="dao1">-->
                            <!--<non-distributed-field>-->
                            <!--connectionPool-->
                            <!--</non-distributed-field>-->
                            <!--</bean>-->
                        </beans>
                        <root-name>server</root-name>
                    </application-context>
                </application-contexts>
            </jee-application>
        </spring>
    </application>
</tc:tc-config>
